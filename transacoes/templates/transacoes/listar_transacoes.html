{% extends "core/base.html" %}

{% block titulo %}Minhas Transações{% endblock %}

{% block conteudo %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Minhas Transações</h2>
    <a href="{% url 'nova_transacao' %}" class="btn btn-success">+ Nova Transação</a>
</div>
<form method="GET" class="row g-3 mb-4">

    <div class="col-md-3">
        <label class="form-label">Mês</label>
        <select name="mes" class="form-select">
            <option value="">Todos</option>

            {% for numero, nome in meses %}
            {% with numero_str=numero|stringformat:"s" mes_req=request.GET.mes|stringformat:"s" %}

            {% if mes_req == numero_str %}
            <option value="{{ numero }}" selected>{{ nome }}</option>
            {% else %}
            <option value="{{ numero }}">{{ nome }}</option>
            {% endif %}

            {% endwith %}
            {% endfor %}
        </select>
    </div>

    <div class="col-md-3">
        <label class="form-label">Ano</label>
        <input type="number" name="ano" class="form-control" value="{{ request.GET.ano }}">
    </div>

    <div class="col-md-3">
        <label class="form-label">Data inicial</label>
        <input type="date" name="data_inicio" class="form-control" value="{{ request.GET.data_inicio }}">
    </div>

    <div class="col-md-3">
        <label class="form-label">Data final</label>
        <input type="date" name="data_fim" class="form-control" value="{{ request.GET.data_fim }}">
    </div>

    <div class="col-12">
        <button class="btn btn-primary">Filtrar</button>
        <a href="{% url 'listar_transacoes' %}" class="btn btn-secondary">Limpar</a>
    </div>

</form>

<div class="row mb-4">

    <div class="col-md-4">
        <div class="card border-success shadow-sm">
            <div class="card-body">
                <h5 class="text-success">Receitas do Período</h5>
                <h3 class="fw-bold">R$ {{ total_receitas|floatformat:2 }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-danger shadow-sm">
            <div class="card-body">
                <h5 class="text-danger">Despesas do Período</h5>
                <h3 class="fw-bold">R$ {{ total_despesas|floatformat:2 }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card border-primary shadow-sm">
            <div class="card-body">
                <h5 class="text-primary">Saldo</h5>
                <h3 class="fw-bold
                    {% if saldo < 0 %}
                        text-danger
                    {% else %}
                        text-success
                    {% endif %}
                ">
                    R$ {{ saldo|floatformat:2 }}
                </h3>
            </div>
        </div>
    </div>

</div>

<table class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>Data</th>
            <th>Descrição</th>
            <th>Valor</th>
            <th>Tipo</th>
            <th>Categoria</th>
            <th>Ações</th>
        </tr>
    </thead>

    <tbody>
        {% for t in transacoes %}
        <tr>
            <td>{{ t.data }}</td>
            <td>{{ t.descricao }}</td>
            <td>R$ {{ t.valor }}</td>
            <td class="{% if t.tipo == 'D' %}text-danger{% else %}text-success{% endif %}">
                {{ t.tipo|title }}
            </td>
            <td>{{ t.categoria }}</td>
            <td>
                <a href="{% url 'editar_transacao' t.id %}" class="btn btn-sm btn-warning">Editar</a>
                <a href="{% url 'excluir_transacao' t.id %}" class="btn btn-sm btn-danger">Excluir</a>
            </td>

        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center text-muted">
                Nenhuma transação cadastrada ainda.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}